fst.dialog=function(name,title,options){fst.dialog.close();options=jQuery.extend({data:new Object},fst.dialog._options[name]===undefined?new Object:fst.dialog._options[name],options===undefined?new Object:options);options.data._content=name;jQuery.ajax({url:"?_content",type:"POST",data:options.data}).done(function(resp){fst.dialog.html(resp,title,options)})};fst.dialog.alert=function(msg,options){if(options===undefined)options={};if(jQuery.type(options)==="string")options={title:options};options=jQuery.extend({buttons:[{text:options.ok===undefined?"OK":options.ok,click:function(){fst.dialog.close(true)}}],title:"Alert"},options);fst.dialog.html(msg,options.title,options)};fst.dialog.cancel=function(){fst.dialog.close()};fst.dialog.close=function(val){if(val!==undefined)fst.dialog.val(val);jQuery('[data-fst="dialog"]').dialog("close")};fst.dialog.confirm=function(msg,options){if(options===undefined)options=new Object;if(jQuery.type(options)==="string")options={title:options};options=jQuery.extend({buttons:[{text:options.ok===undefined?"OK":options.ok,click:function(){fst.dialog.close(true)}},{text:options.cancel===undefined?"Cancel":options.cancel,click:function(){fst.dialog.close(false)}}],title:"Confirm",callback:function(confirmed){}},options);fst.dialog.html(msg,options.title,options)};fst.dialog.form=function(name,title,options){if(options===undefined)options=new Object;options=jQuery.extend({buttons:[{text:options.ok===undefined?"OK":options.ok,click:function(){jQuery('[data-fst="dialog"] form').submit()}},{text:options.cancel===undefined?"Cancel":options.cancel,click:function(){fst.dialog.cancel()}}],callback:function(confirmed){}},options);if(options.postprocess===undefined)options.postprocess=function(){};options.postprocess=function(){var postprocess=options.postprocess;return function(){postprocess.apply(this,arguments);if(jQuery('[data-fst="dialog"] form').length&&!jQuery('[data-fst="dialog"] form input[type="submit"]').length)jQuery('[data-fst="dialog"] form').append('<input type="submit" style="display: none;" />')}}();fst.dialog(name,title,options)};fst.dialog.html=function(html,title,options){fst.dialog.close();options=jQuery.extend(new Object,fst.dialog._options._default,options===undefined?new Object:options);var w_width=$(window).width();var width=options.width?options.width>w_width?w_width:options.width:w_width<600?300:w_width/2;options.preprocess(options);fst.dialog._val=null;jQuery('<div data-fst="dialog"></div>').html(html).dialog({buttons:options.buttons,close:function(){$(this).dialog().remove();options.callback(fst.dialog._val)},closeOnEscape:options.closeOnEscape,dialogClass:options.dialogClass,height:options.height,hide:options.hide,modal:options.modal,position:options.position,show:options.show,title:title,width:width});if(fst._init.datepicker)fst.form.datepicker('div[data-fst="dialog"] input');if(fst._init.timeselect)fst.form.timeselect('div[data-fst="dialog"] input');jQuery('div[data-fst="dialog"] '+'form[data-fst="form"] button[data-fst="form-cancel"]').attr("data-fst","form-dialog-cancel");options.postprocess();jQuery.each(fst.dialog._ready,function(idx,fcn){fcn(jQuery('div[data-fst="dialog"]'))})};fst.dialog._options=new Array;fst.dialog._options._default={callback:function(val){},preprocess:function(){},postprocess:function(){},buttons:[],closeOnEscape:true,dialogClass:"",height:"auto",hide:null,modal:true,position:{my:"center",at:"center",of:window},show:null,width:450};fst.dialog.options=function(name,options){fst.dialog._options[name]=options};fst.dialog.options_default=function(options){jQuery.extend(fst.dialog._options._default,options)};fst.dialog.ready=function(fcn){fst.dialog._ready.push(fcn)};fst.dialog._ready=new Array;fst.dialog.val=function(val){fst.dialog._val=val};fst.dialog._val=null;jQuery(document).on("click",'form[data-fst="form"] button[data-fst="form-dialog-cancel"]',null,function(event){var frm=jQuery(this).closest("form");var name=fst.form.name(frm);var cancel=fst.form._options[name]&&fst.form._options[name].cancel?fst.form._options[name].cancel:fst.dialog.cancel;cancel.apply(frm)});
